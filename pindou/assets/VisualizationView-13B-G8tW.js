import{j as e}from"./index-BxTO2oEd.js";import{r as x}from"./react-vendor-DfuHvqKh.js";import{B as m,R as A,c as H,d as U,e as J,s as K}from"./antd-vendor-CDa6b6_z.js";import"./utils-vendor-DJz00mar.js";const D=({pixelData:o,selectedColors:v,colorTable:B,onClose:b,onUpdatePixelData:E})=>{var w,R,M;const[j,u]=x.useState(null),[p,f]=x.useState(null),[V,y]=x.useState(!1),[l,z]=x.useState(null),[n,T]=x.useState(30),[g,F]=x.useState(10);if(!o||o.length===0)return e.jsxs("div",{className:"visualization-container",children:[e.jsx(m,{icon:e.jsx(A,{}),onClick:b,children:"返回"}),e.jsx("div",{style:{textAlign:"center",marginTop:40},children:"暂无像素画数据"})]});const C=((w=o[0])==null?void 0:w.length)||0,_=s=>{const t=s.replace("#","");return{r:parseInt(t.slice(0,2),16),g:parseInt(t.slice(2,4),16),b:parseInt(t.slice(4,6),16)}},S=(()=>{const s=[];return Object.keys(v).forEach(t=>{(v[t]||[]).forEach(a=>{const r=B.find(c=>c.brand===t&&c.name===a);if(r){const c=r.hex.startsWith("#")?r.hex:"#"+r.hex,d=_(c);s.push({...r,hex:c.toUpperCase(),...d})}})}),s})(),O=(s,t)=>{const h=o[s][t];z({row:s,col:t,color:h}),y(!0)},P=s=>{if(!l)return;const{row:t,col:h}=l,a={...s,hex:s.hex.startsWith("#")?s.hex:"#"+s.hex,r:s.r||0,g:s.g||0,b:s.b||0},r=o.map((c,d)=>d===t?c.map((q,G)=>G===h?a:q):c);E(r),z({...l,color:a}),K.success("颜色已更新")},$=s=>{j===s?u(null):(u(s),f(null))},N=s=>{p===s?f(null):(f(s),u(null))},W=s=>{const t=Math.max(16,Math.min(80,n+s));T(t)},k=s=>{const t=Math.max(6,Math.min(24,g+s));F(t)},i=Math.max(20,Math.min(n*.7,50));return e.jsxs("div",{className:"visualization-container",children:[e.jsxs("div",{className:"visualization-header",children:[e.jsx(m,{icon:e.jsx(A,{}),onClick:b,children:"返回"}),e.jsx("h3",{children:"像素画可视化"}),e.jsxs("div",{style:{display:"flex",gap:16,alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{style:{fontSize:13,color:"#2c3e50"},children:"单元格:"}),e.jsx(m,{icon:e.jsx(H,{}),size:"small",onClick:()=>W(-2),disabled:n<=16}),e.jsxs("span",{style:{minWidth:40,textAlign:"center",fontSize:13,color:"#2c3e50"},children:[n,"px"]}),e.jsx(m,{icon:e.jsx(U,{}),size:"small",onClick:()=>W(2),disabled:n>=80})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{style:{fontSize:13,color:"#2c3e50"},children:"文字:"}),e.jsx(m,{icon:e.jsx(H,{}),size:"small",onClick:()=>k(-1),disabled:g<=6}),e.jsxs("span",{style:{minWidth:40,textAlign:"center",fontSize:13,color:"#2c3e50"},children:[g,"px"]}),e.jsx(m,{icon:e.jsx(U,{}),size:"small",onClick:()=>k(1),disabled:g>=24})]})]})]}),e.jsx("div",{className:"visualization-content",children:e.jsx("div",{className:"visualization-table-wrapper",children:e.jsxs("table",{className:"visualization-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"corner-cell",style:{minWidth:i,width:i,height:i*.7}}),Array.from({length:C},(s,t)=>e.jsx("th",{className:`col-header-cell ${p===t?"highlighted":""}`,onClick:()=>N(t),style:{minWidth:i,width:i,height:i*.7,fontSize:Math.max(9,i*.4)},children:t+1},`top-${t}`)),e.jsx("th",{className:"corner-cell",style:{minWidth:i,width:i,height:i*.7}})]})}),e.jsx("tbody",{children:o.map((s,t)=>e.jsxs("tr",{children:[e.jsx("td",{className:`row-header-cell ${j===t?"highlighted":""}`,onClick:()=>$(t),style:{minWidth:i,width:i,height:n,fontSize:Math.max(9,i*.4)},children:t+1}),s.map((h,a)=>{var d;const r=j===t||p===a,c=l&&l.row===t&&l.col===a;return e.jsx("td",{className:`pixel-cell ${r?"highlighted":""} ${c?"selected":""}`,style:{backgroundColor:(d=h.hex)!=null&&d.startsWith("#")?h.hex:"#"+(h.hex||"").toUpperCase(),width:`${n}px`,height:`${n}px`,minWidth:`${n}px`,minHeight:`${n}px`,maxWidth:`${n}px`,maxHeight:`${n}px`},onClick:()=>O(t,a),title:`行${t+1} 列${a+1}: ${h.name||""}`,children:e.jsx("span",{className:"cell-label",style:{fontSize:`${g}px`,maxWidth:`${n}px`,width:`${n}px`},children:h.name||""})},a)}),e.jsx("td",{className:`row-header-cell ${j===t?"highlighted":""}`,onClick:()=>$(t),style:{minWidth:i,width:i,height:n,fontSize:Math.max(9,i*.4)},children:t+1})]},t))}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"corner-cell",style:{minWidth:i,width:i,height:i*.7}}),Array.from({length:C},(s,t)=>e.jsx("th",{className:`col-header-cell ${p===t?"highlighted":""}`,onClick:()=>N(t),style:{minWidth:i,width:i,height:i*.7,fontSize:Math.max(9,i*.4)},children:t+1},`bottom-${t}`)),e.jsx("th",{className:"corner-cell",style:{minWidth:i,width:i,height:i*.7}})]})})]})})}),e.jsx(J,{title:`编辑单元格 - 行${(l==null?void 0:l.row)!==void 0?l.row+1:""} 列${(l==null?void 0:l.col)!==void 0?l.col+1:""}`,placement:"right",onClose:()=>y(!1),open:V,width:400,children:l&&e.jsxs("div",{children:[e.jsxs("div",{className:"drawer-section",children:[e.jsx("h4",{children:"当前颜色"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"16px",background:"#f5f5f5",borderRadius:8,marginBottom:16},children:[e.jsx("div",{style:{width:60,height:60,backgroundColor:(R=l.color.hex)!=null&&R.startsWith("#")?l.color.hex:"#"+(l.color.hex||"").toUpperCase(),border:"2px solid #ddd",borderRadius:4}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,marginBottom:4},children:l.color.name||"未知"}),e.jsx("div",{style:{color:"#666",fontSize:12},children:(M=l.color.hex)!=null&&M.startsWith("#")?l.color.hex:"#"+(l.color.hex||"").toUpperCase()})]})]})]}),e.jsxs("div",{className:"drawer-section",children:[e.jsx("h4",{children:"选择新颜色"}),e.jsx("div",{style:{marginTop:16},children:S.length===0?e.jsx("div",{style:{color:"#999",textAlign:"center",padding:20},children:"暂无可用颜色，请先选择标准色"}):e.jsx("div",{className:"color-selector-grid",children:S.map(s=>{var a;const t=s.name===l.color.name&&(s.brand===l.color.brand||!s.brand&&!l.color.brand),h=(a=s.hex)!=null&&a.startsWith("#")?s.hex:"#"+(s.hex||"").toUpperCase();return e.jsxs("div",{className:`color-option ${t?"selected":""}`,onClick:()=>P(s),children:[e.jsx("div",{className:"color-option-swatch",style:{backgroundColor:h}}),e.jsx("div",{className:"color-option-name",children:s.name})]},`${s.brand||"default"}-${s.name}`)})})})]})]})})]})};export{D as default};
