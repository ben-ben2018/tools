import{j as e}from"./index-C-xhmonr.js";import{r as x}from"./react-vendor-DfuHvqKh.js";import{B as R,R as z,c as V,s as T}from"./antd-vendor-CmY55PJe.js";import"./utils-vendor-DJz00mar.js";const F=({pixelData:c,selectedColors:j,colorTable:S,onClose:p,onUpdatePixelData:W})=>{var k,$,y;const[h,m]=x.useState(null),[d,g]=x.useState(null),[A,u]=x.useState(!1),[i,v]=x.useState(null);if(!c||c.length===0)return e.jsxs("div",{className:"visualization-container",children:[e.jsx(R,{icon:e.jsx(z,{}),onClick:p,children:"返回"}),e.jsx("div",{style:{textAlign:"center",marginTop:40},children:"暂无像素画数据"})]});const b=((k=c[0])==null?void 0:k.length)||0,U=s=>{const t=s.replace("#","");return{r:parseInt(t.slice(0,2),16),g:parseInt(t.slice(2,4),16),b:parseInt(t.slice(4,6),16)}},f=(()=>{const s=[];return Object.keys(j).forEach(t=>{(j[t]||[]).forEach(l=>{const r=S.find(a=>a.brand===t&&a.name===l);if(r){const a=r.hex.startsWith("#")?r.hex:"#"+r.hex,o=U(a);s.push({...r,hex:a.toUpperCase(),...o})}})}),s})(),w=(s,t)=>{const n=c[s][t];v({row:s,col:t,color:n}),u(!0)},B=s=>{if(!i)return;const{row:t,col:n}=i,l={...s,hex:s.hex.startsWith("#")?s.hex:"#"+s.hex,r:s.r||0,g:s.g||0,b:s.b||0},r=c.map((a,o)=>o===t?a.map((E,H)=>H===n?l:E):a);W(r),v({...i,color:l}),T.success("颜色已更新")},N=s=>{h===s?m(null):(m(s),g(null))},C=s=>{d===s?g(null):(g(s),m(null))};return e.jsxs("div",{className:"visualization-container",children:[e.jsxs("div",{className:"visualization-header",children:[e.jsx(R,{icon:e.jsx(z,{}),onClick:p,children:"返回"}),e.jsx("h3",{children:"像素画可视化"}),e.jsx("div",{style:{width:80}})," "]}),e.jsx("div",{className:"visualization-content",children:e.jsx("div",{className:"visualization-table-wrapper",children:e.jsxs("table",{className:"visualization-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"corner-cell"}),Array.from({length:b},(s,t)=>e.jsx("th",{className:`col-header-cell ${d===t?"highlighted":""}`,onClick:()=>C(t),children:t+1},`top-${t}`)),e.jsx("th",{className:"corner-cell"})]})}),e.jsx("tbody",{children:c.map((s,t)=>e.jsxs("tr",{children:[e.jsx("td",{className:`row-header-cell ${h===t?"highlighted":""}`,onClick:()=>N(t),children:t+1}),s.map((n,l)=>{var o;const r=h===t||d===l,a=i&&i.row===t&&i.col===l;return e.jsx("td",{className:`pixel-cell ${r?"highlighted":""} ${a?"selected":""}`,style:{backgroundColor:(o=n.hex)!=null&&o.startsWith("#")?n.hex:"#"+(n.hex||"").toUpperCase()},onClick:()=>w(t,l),title:`行${t+1} 列${l+1}: ${n.name||""}`,children:e.jsx("span",{className:"cell-label",children:n.name||""})},l)}),e.jsx("td",{className:`row-header-cell ${h===t?"highlighted":""}`,onClick:()=>N(t),children:t+1})]},t))}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"corner-cell"}),Array.from({length:b},(s,t)=>e.jsx("th",{className:`col-header-cell ${d===t?"highlighted":""}`,onClick:()=>C(t),children:t+1},`bottom-${t}`)),e.jsx("th",{className:"corner-cell"})]})})]})})}),e.jsx(V,{title:`编辑单元格 - 行${(i==null?void 0:i.row)!==void 0?i.row+1:""} 列${(i==null?void 0:i.col)!==void 0?i.col+1:""}`,placement:"right",onClose:()=>u(!1),open:A,width:400,children:i&&e.jsxs("div",{children:[e.jsxs("div",{className:"drawer-section",children:[e.jsx("h4",{children:"当前颜色"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"16px",background:"#f5f5f5",borderRadius:8,marginBottom:16},children:[e.jsx("div",{style:{width:60,height:60,backgroundColor:($=i.color.hex)!=null&&$.startsWith("#")?i.color.hex:"#"+(i.color.hex||"").toUpperCase(),border:"2px solid #ddd",borderRadius:4}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,marginBottom:4},children:i.color.name||"未知"}),e.jsx("div",{style:{color:"#666",fontSize:12},children:(y=i.color.hex)!=null&&y.startsWith("#")?i.color.hex:"#"+(i.color.hex||"").toUpperCase()})]})]})]}),e.jsxs("div",{className:"drawer-section",children:[e.jsx("h4",{children:"选择新颜色"}),e.jsx("div",{style:{marginTop:16},children:f.length===0?e.jsx("div",{style:{color:"#999",textAlign:"center",padding:20},children:"暂无可用颜色，请先选择标准色"}):e.jsx("div",{className:"color-selector-grid",children:f.map(s=>{var l;const t=s.name===i.color.name&&(s.brand===i.color.brand||!s.brand&&!i.color.brand),n=(l=s.hex)!=null&&l.startsWith("#")?s.hex:"#"+(s.hex||"").toUpperCase();return e.jsxs("div",{className:`color-option ${t?"selected":""}`,onClick:()=>B(s),children:[e.jsx("div",{className:"color-option-swatch",style:{backgroundColor:n}}),e.jsx("div",{className:"color-option-name",children:s.name})]},`${s.brand||"default"}-${s.name}`)})})})]})]})})]})};export{F as default};
